@using GuitarChords.Models

<div class="chord-diagram">
    <MudPaper Class="pa-4" Elevation="2">
        <MudText Typo="Typo.h6" Align="Align.Center" Class="mb-2">@Chord.Name</MudText>
        
        <svg width="@Width" height="@Height" viewBox="0 0 @Width @Height">
            <!-- Fretboard -->
            <rect x="@FretboardX" y="@FretboardY" width="@FretboardWidth" height="@FretboardHeight" 
                  fill="#8B4513" stroke="#000" stroke-width="2"/>
            
            <!-- Frets -->
            @for (int fret = 0; fret <= VisibleFrets; fret++)
            {
                var y = FretboardY + (fret * FretHeight);
                <line x1="@FretboardX" y1="@y" x2="@(FretboardX + FretboardWidth)" y2="@y" 
                      stroke="#C0C0C0" stroke-width="@(fret == 0 ? 4 : 2)"/>
            }
            
            <!-- Strings -->
            @for (int str = 0; str < 6; str++)
            {
                var x = FretboardX + StringSpacing + (str * StringSpacing);
                <line x1="@x" y1="@FretboardY" x2="@x" y2="@(FretboardY + FretboardHeight)" 
                      stroke="#000" stroke-width="@(2 - str * 0.2)"/>
            }
            
            <!-- String labels -->
            @for (int str = 0; str < 6; str++)
            {
                var x = FretboardX + StringSpacing + (str * StringSpacing);
                var note = GuitarTuning.StandardTuning[5 - str];
                var noteText = note.Name.ToString() + (note.Alteration == Alteration.Sharp ? "#" : "");
                @:<text x="@x" y="@(Height - 5)" text-anchor="middle" font-size="12" font-weight="bold">@noteText</text>
            }
            
            <!-- Fret numbers (if not starting from the first fret) -->
            @if (Chord.BaseFret > 0)
            {
                var fretText = Chord.BaseFret + " fr";
                @:<text x="@(FretboardX - 20)" y="@(FretboardY + FretHeight / 2)" text-anchor="middle" font-size="14" font-weight="bold">@fretText</text>
            }
            
            <!-- Finger positions -->
            @for (int str = 0; str < 6; str++)
            {
                var fret = Chord.FretPositions[5 - str]; // Reverse for display
                var x = FretboardX + StringSpacing + (str * StringSpacing);
                
                if (fret == -1)
                {
                    // Muted string (X)
                    @:<text x="@x" y="@(FretboardY - 10)" text-anchor="middle" font-size="20" font-weight="bold">Ã—</text>
                }
                else if (fret == 0)
                {
                    // Open string (O)
                    <circle cx="@x" cy="@(FretboardY - 10)" r="8" 
                            fill="none" stroke="#000" stroke-width="2"/>
                }
                else
                {
                    // Fretted note
                    var displayFret = fret - Chord.BaseFret;
                    if (displayFret >= 0 && displayFret < VisibleFrets)
                    {
                        var y = FretboardY + (displayFret * FretHeight) + (FretHeight / 2);
                        <circle cx="@x" cy="@y" r="10" fill="#000"/>
                        
                        // Show finger number if available
                        var finger = Chord.Fingerings[5 - str];
                        if (finger > 0)
                        {
                            @:<text x="@x" y="@(y + 4)" text-anchor="middle" font-size="12" fill="#FFF" font-weight="bold">@finger</text>
                        }
                    }
                }
            }
            
            <!-- Barre indication -->
            @if (Chord.IsBarreChord && Chord.BarreFret.HasValue && Chord.BarredStrings.Count > 1)
            {
                var minString = Chord.BarredStrings.Min();
                var maxString = Chord.BarredStrings.Max();
                var x1 = FretboardX + StringSpacing + ((5 - maxString) * StringSpacing);
                var x2 = FretboardX + StringSpacing + ((5 - minString) * StringSpacing);
                var barreFret = Chord.BarreFret.Value - Chord.BaseFret;
                if (barreFret >= 0 && barreFret < VisibleFrets)
                {
                    var y = FretboardY + (barreFret * FretHeight) + (FretHeight / 2);
                    <rect x="@(x1 - 10)" y="@(y - 10)" width="@(x2 - x1 + 20)" height="20" 
                          rx="10" ry="10" fill="#000" opacity="0.8"/>
                }
            }
        </svg>
    </MudPaper>
</div>

@code {
    [Parameter] public GuitarChord Chord { get; set; } = null!;
    [Parameter] public int Width { get; set; } = 200;
    [Parameter] public int Height { get; set; } = 250;
    
    private int FretboardX => 30;
    private int FretboardY => 40;
    private int FretboardWidth => Width - 60;
    private int FretboardHeight => Height - 80;
    private int StringSpacing => FretboardWidth / 6;
    private int VisibleFrets => 4;
    private int FretHeight => FretboardHeight / VisibleFrets;
}

<style>
    .chord-diagram {
        display: inline-block;
        margin: 8px;
    }
</style>